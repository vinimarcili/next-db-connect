# Next.js Oracle Database Connection

Este Ã© um projeto [Next.js](https://nextjs.org) com integraÃ§Ã£o ao Oracle Database usando TypeORM. O projeto inclui um sistema de inscriÃ§Ãµes (subscribers) com funcionalidades de criaÃ§Ã£o e exportaÃ§Ã£o de dados em CSV.

## ğŸš€ Funcionalidades

- âœ… **FormulÃ¡rio de InscriÃ§Ã£o**: Interface para coleta de dados de usuÃ¡rios
- âœ… **IntegraÃ§Ã£o Oracle Database**: ConexÃ£o com Oracle Cloud usando TypeORM
- âœ… **ValidaÃ§Ã£o de Dados**: ValidaÃ§Ã£o completa de nome, email e gÃªnero
- âœ… **Export CSV Protegido**: Download de dados com autenticaÃ§Ã£o OAuth
- âœ… **API REST**: Endpoints para criaÃ§Ã£o e consulta de subscribers

## ğŸ› ï¸ Tecnologias

- **Frontend**: Next.js 15, React 18, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes, TypeORM
- **Database**: Oracle Database (Oracle Cloud)
- **ValidaÃ§Ã£o**: Sistema personalizado de validaÃ§Ã£o
- **AutenticaÃ§Ã£o**: Basic Auth para rotas administrativas

## âš™ï¸ ConfiguraÃ§Ã£o do Ambiente

1. **Clone o repositÃ³rio**

```bash
git clone <repository-url>
cd next-db-connect
```

2. **Instale as dependÃªncias**

```bash
npm install
# ou
yarn install
```

3. **Configure as variÃ¡veis de ambiente**

Copie o arquivo `.env.example` para `.env.local`:

```bash
cp .env.example .env.local
```

Configure as seguintes variÃ¡veis no `.env.local`:

```env
# Oracle Cloud Database Configuration
ORACLE_HOST=seu_host_oracle
ORACLE_PORT=1522
ORACLE_USER=seu_usuario
ORACLE_PASSWORD=sua_senha
ORACLE_SERVICE_NAME=seu_service_name
ORACLE_SSL=true
ORACLE_RETRY_COUNT=20
ORACLE_RETRY_DELAY=3

# Next SELF URL
NEXT_PUBLIC_API_URL=http://localhost:3000

# Admin Credentials for CSV Download
ADMIN_USERNAME=admin
ADMIN_PASSWORD=sua_senha_segura
```

4. **Execute o servidor de desenvolvimento**

```bash
npm run dev
# ou
yarn dev
```

Acesse [http://localhost:3000](http://localhost:3000) no seu navegador.

## ğŸ“¡ API Endpoints

### POST /api/subscribers

Cria um novo subscriber no sistema.

**Payload:**

```json
{
  "name": "JoÃ£o Silva",
  "email": "joao@email.com",
  "gender": "male"
}
```

**Resposta de Sucesso:**

```json
{
  "success": true,
  "message": "Subscriber salvo com sucesso! (criado ou atualizado)"
}
```

**ValidaÃ§Ãµes:**

- **Nome**: ObrigatÃ³rio, mÃ­nimo 2 caracteres
- **Email**: ObrigatÃ³rio, formato vÃ¡lido
- **GÃªnero**: ObrigatÃ³rio, valores: "male", "female", "other"

### GET /api/subscribers (Protegido)

Exporta todos os subscribers em formato CSV.

**AutenticaÃ§Ã£o:** Basic Auth (credenciais definidas nas variÃ¡veis de ambiente)

**Headers ObrigatÃ³rios:**

```
Authorization: Basic <base64(username:password)>
```

**Resposta:** Arquivo CSV para download

## ğŸ”’ Download de CSV Protegido

A rota de exportaÃ§Ã£o estÃ¡ protegida com autenticaÃ§Ã£o Basic Auth para garantir seguranÃ§a dos dados.

### Como usar

**Via cURL:**

```bash
curl -u admin:sua_senha \
  -H "Accept: text/csv" \
  -o subscribers.csv \
  http://localhost:3000/api/subscribers
```

**Via JavaScript:**

```javascript
const username = 'admin';
const password = 'sua_senha';
const credentials = btoa(`${username}:${password}`);

fetch('/api/subscribers', {
  method: 'GET',
  headers: {
    'Authorization': `Basic ${credentials}`,
    'Accept': 'text/csv'
  }
})
.then(response => {
  if (response.ok) {
    return response.blob();
  }
  throw new Error('Falha na autenticaÃ§Ã£o');
})
.then(blob => {
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'subscribers.csv';
  a.click();
  window.URL.revokeObjectURL(url);
});
```

### Formato do CSV

O arquivo CSV contÃ©m as seguintes colunas:

- **ID**: Identificador Ãºnico
- **Nome**: Nome completo do subscriber
- **Email**: EndereÃ§o de email
- **GÃªnero**: GÃªnero selecionado (male/female/other)
- **Data CriaÃ§Ã£o**: Data de criaÃ§Ã£o (YYYY-MM-DD)
- **Data AtualizaÃ§Ã£o**: Data da Ãºltima atualizaÃ§Ã£o (YYYY-MM-DD)

## ğŸ—„ï¸ Estrutura do Banco de Dados

**Tabela: SUBSCRIBERS**

```sql
CREATE TABLE subscribers (
   id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   name VARCHAR2(100) NOT NULL,
   email VARCHAR2(255) NOT NULL UNIQUE,
   gender VARCHAR2(10),
   created_at DATE DEFAULT SYSDATE,
   updated_at DATE DEFAULT SYSDATE
);
```

## ğŸ§ª Testes

**Testar conexÃ£o com o banco:**

```bash
npm run test-db
```

## ğŸ“ Estrutura do Projeto

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ subscribers/
â”‚   â”‚       â””â”€â”€ route.ts          # API endpoints
â”‚   â”œâ”€â”€ globals.css
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx                  # PÃ¡gina principal
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ data-source.ts           # ConfiguraÃ§Ã£o TypeORM
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ subscribers.entity.ts # Entidade Subscribers
â”‚   â””â”€â”€ sql/
â”‚       â””â”€â”€ subscribes.sql       # Script de criaÃ§Ã£o da tabela
â”œâ”€â”€ interfaces/                   # DefiniÃ§Ãµes de tipos
â”œâ”€â”€ ui/
â”‚   â””â”€â”€ components/              # Componentes React
â”œâ”€â”€ validators/                   # Sistema de validaÃ§Ã£o
â””â”€â”€ types/                       # DefiniÃ§Ãµes TypeScript globais
```

## ğŸ”§ Comandos Ãšteis

- `npm run dev` - Inicia o servidor de desenvolvimento
- `npm run build` - Gera build de produÃ§Ã£o
- `npm run start` - Inicia servidor de produÃ§Ã£o
- `npm run test-db` - Testa conexÃ£o com o banco de dados

## ğŸ“ Notas Importantes

- Configure corretamente as credenciais do Oracle Database
- Mantenha as credenciais administrativas seguras
- O arquivo CSV Ã© gerado dinamicamente a cada requisiÃ§Ã£o
- A tabela deve ser criada manualmente usando o script SQL fornecido

## ğŸ“š Recursos Adicionais

- [Next.js Documentation](https://nextjs.org/docs)
- [TypeORM Documentation](https://typeorm.io/)
- [Oracle Database Cloud](https://www.oracle.com/cloud/database/)
